


name: Build and Push Docker Image to Docker Hub

on: 
  push:
    branches:
      - main
      - Development
      - clean-Development
jobs:
    push_to_hub:
        name: push image to repo
        runs-on: ubuntu-latest
        steps:
          - name: check repo
            uses: actions/checkout@v4

          - name: List repo contents
            run: ls -R

          - name: login to DockerHub
            uses: docker/login-action@v3
            with:
              username: ${{secrets.SOFTELSIE_DOCKER_USERNAME}}
              password: ${{secrets.SOFTELSIE_DOCKER_HUB_ACCESS_TOKEN}}
          
          - name: build and push docker image to DockerHub
            uses: docker/build-push-action@v5
            with:
              context: ./
              file: ./DockerFile
              push: true
              tags: phedzi/skuata:latest
              build-args: |
                SOFTELSIE_GITHUB_PACKAGE_INSTALLER_USERNAME=${{secrets.SOFTELSIE_GITHUB_PACKAGE_INSTALLER_USERNAME}}
                SOFTELSIE_GITHUB_PACKAGE_INSTALLER_TOKEN=${{secrets.SOFTELSIE_GITHUB_PACKAGE_INSTALLER_TOKEN}}

          - name: Deploy to Azure Web App for Containers
            uses: azure/webapps-deploy@v2
            with:
             app-name: 'skuata'              
             publish-profile: ${{ secrets.AZURE_WEBAPP_PUBLISH_PROFILE }}
             images: 'phedzi/skuata:latest'

